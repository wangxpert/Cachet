$(function(){function e(e,t){$(".block-"+e).removeClass("show").addClass("hidden"),$(".block-"+t).removeClass("hidden").addClass("show"),$(".steps .step").removeClass("active").filter(":lt("+t+")").addClass("active")}$.ajaxPrefilter(function(e,t,n){var o;return!e.crossDomain&&(o=$('meta[name="token"]').attr("content"))?n.setRequestHeader("X-CSRF-Token",o):void 0}),$.ajaxSetup({statusCode:{401:function(){window.location.href="/"},403:function(){window.location.href="/"}}}),autosize($("textarea.autosize")),$("form").submit(function(){var e=$(this);e.find(":submit").prop("disabled",!0)}),$("[data-method]").not(".disabled").append(function(){var e="\n";return e+="<form action='"+$(this).attr("href")+"' method='POST' style='display:none'>\n",e+=" <input type='hidden' name='_method' value='"+$(this).attr("data-method")+"'>\n",$(this).attr("data-token")&&(e+="<input type='hidden' name='_token' value='"+$(this).attr("data-token")+"'>\n"),e+="</form>\n"}).removeAttr("href").attr("onclick",' if ($(this).hasClass(\'confirm-action\')) { if(confirm("Are you sure you want to do this?")) { $(this).find("form").submit(); } } else { $(this).find("form").submit(); }'),Messenger.options={extraClasses:"messenger-fixed messenger-on-top",theme:"air"},window.CachetHQ={},moment.locale(Global.locale),$("abbr.timeago").each(function(){var e=$(this);e.livestamp(e.data("timeago")).tooltip()}),window.CachetHQ.Notifier=function(){this.notify=function(e,t,n){t="undefined"==typeof t||"error"===t?"error":t;var o={message:e,type:t,showCloseButton:!0};n=_.extend(o,n),Messenger().post(n)}},$(".sidebar-toggler").click(function(e){e.preventDefault(),$(".wrapper").toggleClass("toggled")}),$(".color-code").minicolors({control:"hue",defaultValue:$(this).val()||"",inline:!1,letterCase:"lowercase",opacity:!1,position:"bottom left",theme:"bootstrap"}),$('[data-toggle="tooltip"]').tooltip(),$("button.close").on("click",function(){$(this).parents("div.alert").addClass("hide")}),$("form[name=IncidentForm] select[name=incident\\[component_id\\]]").on("change",function(){var e=$(this).find("option:selected"),t=$("#component-status");""!==e.val()&&(t.hasClass("hidden")?t.removeClass("hidden"):t.addClass("hidden"))}),$("input[rel=datepicker]").datetimepicker({format:"DD/MM/YYYY HH:mm",minDate:new Date,sideBySide:!0,icons:{time:"ion-clock",date:"ion-android-calendar",up:"ion-ios-arrow-up",down:"ion-ios-arrow-down",previous:"ion-ios-arrow-left",next:"ion-ios-arrow-right",today:"ion-android-home",clear:"ion-trash-a"}});var t=document.getElementById("component-list");t&&new Sortable(t,{group:"omega",handle:".drag-handle",onUpdate:function(){var e=$("#component-list .striped-list-item");$.each(e,function(e){$(this).find("input[rel=order]").val(e+1)}),$.ajax({async:!0,url:"/dashboard/api/components/order",type:"POST",data:$("form[name=componentList]").serializeObject(),success:function(){(new CachetHQ.Notifier).notify("Components updated.","success")}})}}),$("form.component-inline").on("click","input[type=radio]",function(){var e=$(this).parents("form"),t=e.serializeObject();$.ajax({async:!0,url:"/dashboard/api/components/"+t.component_id,type:"POST",data:t,success:function(){(new CachetHQ.Notifier).notify(e.data("messenger"),"success")},error:function(){(new CachetHQ.Notifier).notify("Something went wrong updating the component.")}})}),$("select[name=template]").on("change",function(){var e=$(this).find("option:selected"),t=e.val();t&&$.ajax({async:!0,dataType:"json",data:{slug:t},url:"/dashboard/api/incidents/templates",success:function(e){var t=$("form[role=form]");t.find("input[name=incident\\[name\\]]").val(e.name),t.find("textarea[name=incident\\[message\\]]").val(e.template)},error:function(){(new CachetHQ.Notifier).notify("There was an error finding that template.")}})}),$("#remove-banner").click(function(){$("#banner-view").remove(),$("input[name=remove_banner]").val("1")}),$(".wizard-next").on("click",function(){var t=$("#setup-form"),n=$(this),o=n.data("currentBlock"),a=n.data("nextBlock");if(n.button("loading"),a>o){var i="/setup/step"+o;return $.post(i,t.serializeObject()).done(function(){e(o,a)}).fail(function(e){var t=_.toArray(e.responseJSON.errors);_.each(t,function(e){(new CachetHQ.Notifier).notify(e)})}).always(function(){n.button("reset")}),!1}e(o,a),n.button("reset")})});